
# General settings
# ============================
set -g mouse on
set -g history-limit 10000
setw -g mode-keys vi
set -g focus-events on

# Instant Esc key and jk/jj mapping responsiveness
set -s escape-time 0

# Truecolor support
set -g default-terminal "tmux-256color"
set -as terminal-features "tmux-256color:RGB"

# ============================
# Prefix
# ============================
unbind C-b
set -g prefix C-Space
bind C-Space send-prefix

# ============================
# Reload Config
# ============================
bind R source-file ~/.config/tmux/tmux.conf \; display-message "✅ Tmux config reloaded!"

# ============================
# Seamless Vim + Tmux navigation (C-h/j/k/l)
# ============================
is_vim="ps -o state= -o comm= -t '#{pane_tty}' | grep -iqE '^[^TXZ ]+ +(n?vim|vimx?|viewx?|lazygit)$'"

bind -n C-h if-shell "$is_vim" "send-keys C-h" "select-pane -L"
bind -n C-j if-shell "$is_vim" "send-keys C-j" "select-pane -D"
bind -n C-k if-shell "$is_vim" "send-keys C-k" "select-pane -U"
bind -n C-l if-shell "$is_vim" "send-keys C-l" "select-pane -R"
bind -n "C-\\" if-shell "$is_vim" "send-keys C-\\" "select-pane -l"

# Disable repeat timeout for smoother movement
set -g repeat-time 0

# ============================
# Splits
# ============================
bind | split-window -h -c "#{pane_current_path}"
bind - split-window -v -c "#{pane_current_path}"

# Pane resizing (Alt + hjkl)
bind -r M-h resize-pane -L 5
bind -r M-l resize-pane -R 5
bind -r M-j resize-pane -D 5
bind -r M-k resize-pane -U 5

# ============================
# Windows (Tabs)
# ============================
bind t new-window -c "#{pane_current_path}"
bind r command-prompt "rename-window %%"

# Alt+Tab to cycle through windows
bind -n M-Tab next-window \; display-message "➡️  Next window"
bind -n M-S-Tab previous-window \; display-message "⬅️  Previous window"

# ============================
# Copy / Paste with clipboard
# ============================
bind -T copy-mode-vi v send-keys -X begin-selection
bind -T copy-mode-vi V send-keys -X select-line
bind -T copy-mode-vi y send-keys -X copy-pipe-and-cancel "pbcopy"

# ============================
# LazyGit popup
# ============================
bind g display-popup -E lazygit

# ============================
# Maximize / Restore Pane
# ============================
bind m resize-pane -Z

# ============================
# Status Bar (Gruvbox Material)
# ============================
set -g status on
set -g status-interval 5
set -g status-justify centre

# Colors
set -g status-style bg=colour235,fg=colour223

# Left side (session)
set -g status-left '#[fg=colour223,bg=colour235,bold] #S #[fg=colour235,bg=colour223,nobold]'

# Window list styling
setw -g window-status-style fg=colour245,bg=colour236
setw -g window-status-current-style fg=colour235,bg=colour223,bold

# Right side (date/time)
set -g status-right '#[fg=colour245,bg=colour236] %Y-%m-%d #[fg=colour245,bg=colour235] %H:%M '

# ============================
# Plugins via TPM
# ============================
set -g @plugin 'tmux-plugins/tpm'

# Initialize TPM (MUST BE LAST)
run '~/.config/tmux/plugins/tpm/tpm'
